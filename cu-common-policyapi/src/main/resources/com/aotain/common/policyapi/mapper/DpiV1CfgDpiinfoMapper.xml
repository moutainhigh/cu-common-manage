<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aotain.common.policyapi.mapper.DpiV1CfgDpiinfoMapper">
  <resultMap id="BaseResultMap" type="com.aotain.common.policyapi.model.DpiV1CfgDpiinfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="DEV_ID" jdbcType="DECIMAL" property="devId" />
    <result column="MESSAGE_NO" jdbcType="DECIMAL" property="messageNo" />
    <result column="DPI_IP" jdbcType="VARCHAR" property="ip" />
    <result column="DPI_PORT" jdbcType="DECIMAL" property="port" />
    <result column="DPI_DEV_NAME" jdbcType="VARCHAR" property="devName" />
    <result column="DPI_SITE_NAME" jdbcType="VARCHAR" property="deploySiteName" />
    <result column="OPERATETYPE" jdbcType="DECIMAL" property="operationType" />
    <result column="MESSAGE_SEQUENCENO" jdbcType="DECIMAL" property="messageSequenceNo" />
    <result column="DEV_FLAG" jdbcType="DECIMAL" property="devFlag" />
    <result column="ZONGFEN_ID" jdbcType="DECIMAL" property="zongfenId" />
    <result column="AREA_CODE" jdbcType="DECIMAL" property="areaCode" />
    <result column="IDC_PORT" jdbcType="DECIMAL" property="idcPort" />
    <result column="PROBE_TYPE" jdbcType="DECIMAL" property="probeType" />
    <result column="CONNECTFLAG" jdbcType="DECIMAL" property="connectFlag" />
    <result column="OPERATEFLAG" jdbcType="DECIMAL" property="operateFlag" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="UPDATETIME" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="DEV_IP" jdbcType="VARCHAR" property="zfDeviceIp" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    DEV_ID, MESSAGE_NO, DPI_IP, DPI_PORT, DPI_DEV_NAME, DPI_SITE_NAME, OPERATETYPE, MESSAGE_SEQUENCENO, 
    DEV_FLAG, ZONGFEN_ID, AREA_CODE, IDC_PORT, PROBE_TYPE, CONNECTFLAG, OPERATEFLAG, 
    REMARK, UPDATETIME,DEV_IP
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from  (SELECT V.*,Z.Dev_Ip from  DPI_V1_CFG_DPIINFO V LEFT JOIN Dpi_V1_Cfg_Zongfeninfo Z ON Z.Dev_Id=V.Zongfen_Id)
    where DEV_ID = #{devId,jdbcType=DECIMAL}
  </select>

  <!--  delete采用逻辑删除，即不删除数据 只是将其设置为删除状态      -->
  <update id="deleteData" parameterType="com.aotain.common.policyapi.model.DpiV1CfgDpiinfo">
    UPDATE dpi_v1_cfg_dpiinfo
    SET operatetype = ${@com.aotain.common.policyapi.constant.OperationConstants@OPERATION_DELETE},
        message_sequenceno = #{messageSequenceNo}
    WHERE dev_id = #{devId}
  </update>
  <insert id="insertData" parameterType="com.aotain.common.policyapi.model.DpiV1CfgDpiinfo">
    <selectKey keyProperty="devId" resultType="java.lang.Long" order="BEFORE">
      select SEQ_DPI_V1_CFG_DPIINFO_ID.NEXTVAL from dual
    </selectKey>
    insert into  DPI_V1_CFG_DPIINFO (DEV_ID, MESSAGE_NO, DPI_IP, 
      DPI_PORT, DPI_DEV_NAME, DPI_SITE_NAME, 
      OPERATETYPE, MESSAGE_SEQUENCENO, DEV_FLAG, 
      ZONGFEN_ID, AREA_CODE, IDC_PORT, 
      PROBE_TYPE, CONNECTFLAG, OPERATEFLAG, 
      REMARK, UPDATETIME,CREATE_USERID)
    values (#{devId,jdbcType=DECIMAL}, #{messageNo,jdbcType=DECIMAL}, #{ip,jdbcType=VARCHAR}, 
      #{port,jdbcType=DECIMAL}, #{devName,jdbcType=VARCHAR}, #{deploySiteName,jdbcType=VARCHAR},
      ${@com.aotain.common.policyapi.constant.OperationConstants@OPERATION_SAVE}, #{messageSequenceNo,jdbcType=DECIMAL}, #{devFlag,jdbcType=DECIMAL},
      #{zongfenId,jdbcType=DECIMAL}, #{areaCode,jdbcType=DECIMAL}, #{idcPort,jdbcType=DECIMAL}, 
      #{probeType,jdbcType=DECIMAL}, #{connectFlag,jdbcType=SMALLINT}, #{operateFlag,jdbcType=SMALLINT},
      #{remark,jdbcType=VARCHAR}, sysdate,#{userId,jdbcType=DECIMAL})
  </insert>
  <insert id="insertSelective" parameterType="com.aotain.common.policyapi.model.DpiV1CfgDpiinfo">
    <selectKey keyProperty="devId" resultType="java.lang.Long" order="BEFORE">
      select SEQ_DPI_V1_CFG_DPIINFO_ID.NEXTVAL from dual
    </selectKey>
    insert into  DPI_V1_CFG_DPIINFO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="devId != null">
        DEV_ID,
      </if>
      <if test="messageNo != null">
        MESSAGE_NO,
      </if>
      <if test="ip != null">
        DPI_IP,
      </if>
      <if test="port != null">
        DPI_PORT,
      </if>
      <if test="devName != null">
        DPI_DEV_NAME,
      </if>
      <if test="deploySiteName != null">
        DPI_SITE_NAME,
      </if>
      <if test="operateType != null">
        OPERATETYPE,
      </if>
      <if test="messageSequenceNo != null">
        MESSAGE_SEQUENCENO,
      </if>
      <if test="devFlag != null">
        DEV_FLAG,
      </if>
      <if test="zongfenId != null">
        ZONGFEN_ID,
      </if>
      <if test="areaCode != null">
        AREA_CODE,
      </if>
      <if test="idcPort != null">
        IDC_PORT,
      </if>
      <if test="probeType != null">
        PROBE_TYPE,
      </if>
      <if test="connectFlag != null">
        CONNECTFLAG,
      </if>
      <if test="operateFlag != null">
        OPERATEFLAG,
      </if>
      <if test="remark != null">
        REMARK,
      </if>
      <if test="updateTime != null">
        UPDATETIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="devId != null">
        #{devId,jdbcType=DECIMAL},
      </if>
      <if test="messageNo != null">
        #{messageNo,jdbcType=DECIMAL},
      </if>
      <if test="ip != null">
        #{ip,jdbcType=VARCHAR},
      </if>
      <if test="port != null">
        #{port,jdbcType=DECIMAL},
      </if>
      <if test="devName != null">
        #{devName,jdbcType=VARCHAR},
      </if>
      <if test="deploySiteName != null">
        #{deploySiteName,jdbcType=VARCHAR},
      </if>
      <if test="operateType != null">
        ${@com.aotain.common.policyapi.constant.OperationConstants@OPERATION_SAVE},
      </if>
      <if test="messageSequenceNo != null">
        #{messageSequenceno,jdbcType=DECIMAL},
      </if>
      <if test="devFlag != null">
        #{devFlag,jdbcType=DECIMAL},
      </if>
      <if test="zongfenId != null">
        #{zongfenId,jdbcType=DECIMAL},
      </if>
      <if test="areaCode != null">
        #{areaCode,jdbcType=DECIMAL},
      </if>
      <if test="idcPort != null">
        #{idcPort,jdbcType=DECIMAL},
      </if>
      <if test="probeType != null">
        #{probeType,jdbcType=DECIMAL},
      </if>
      <if test="connectFlag != null">
        #{connectflag,jdbcType=DECIMAL},
      </if>
      <if test="operateFlag != null">
        #{operateflag,jdbcType=DECIMAL},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        sysdate,
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.aotain.common.policyapi.model.DpiV1CfgDpiinfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update DPI_V1_CFG_DPIINFO
    <set>
      <if test="messageNo != null">
        MESSAGE_NO = #{messageNo,jdbcType=DECIMAL},
      </if>
      <if test="ip != null">
        DPI_IP = #{ip,jdbcType=VARCHAR},
      </if>
      <if test="port != null">
        DPI_PORT = #{port,jdbcType=DECIMAL},
      </if>
      <if test="devName != null">
        DPI_DEV_NAME = #{devName,jdbcType=VARCHAR},
      </if>
      <if test="deploySiteName != null">
        DPI_SITE_NAME = #{deploySiteName,jdbcType=VARCHAR},
      </if>
      <if test="operateType != null">
        OPERATETYPE = ${@com.aotain.common.policyapi.constant.OperationConstants@OPERATION_UPDATE},
      </if>
      <if test="messageSequenceNo != null">
        MESSAGE_SEQUENCENO = #{messageSequenceno,jdbcType=DECIMAL},
      </if>
      <if test="devFlag != null">
        DEV_FLAG = #{devFlag,jdbcType=DECIMAL},
      </if>
      <if test="zongfenId != null">
        ZONGFEN_ID = #{zongfenId,jdbcType=DECIMAL},
      </if>
      <if test="areaCode != null">
        AREA_CODE = #{areaCode,jdbcType=DECIMAL},
      </if>
      <if test="idcPort != null">
        IDC_PORT = #{idcPort,jdbcType=DECIMAL},
      </if>
      <if test="probeType != null">
        PROBE_TYPE = #{probeType,jdbcType=DECIMAL},
      </if>
      <if test="connectFlag != null">
        CONNECTFLAG = #{connectFlag,jdbcType=DECIMAL},
      </if>
      <if test="operateFlag != null">
        OPERATEFLAG = #{operateFlag,jdbcType=DECIMAL},
      </if>
      <if test="remark != null">
        REMARK = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        UPDATETIME = sysdate,
      </if>
      
    </set>
    where DEV_ID = #{devId,jdbcType=DECIMAL}
  </update>
  <update id="updateData" parameterType="com.aotain.common.policyapi.model.DpiV1CfgDpiinfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update DPI_V1_CFG_DPIINFO
    set
      DPI_PORT = #{port,jdbcType=DECIMAL},
      DPI_DEV_NAME = #{devName,jdbcType=VARCHAR},
      DPI_SITE_NAME = #{deploySiteName,jdbcType=VARCHAR},
      OPERATETYPE = ${@com.aotain.common.policyapi.constant.OperationConstants@OPERATION_UPDATE},
      MESSAGE_SEQUENCENO = #{messageSequenceNo,jdbcType=DECIMAL},
      ZONGFEN_ID = #{zongfenId,jdbcType=DECIMAL},
      UPDATETIME = sysdate,
      create_userid= #{userId,jdbcType=DECIMAL}
    where DEV_ID = #{devId,jdbcType=DECIMAL}
  </update>

  <select id="selectDevIdByDevIpAndOperationType" parameterType="string" resultType="com.aotain.common.policyapi.model.DpiV1CfgDpiinfo">
      select
        DEV_ID AS devId,
        MESSAGE_NO AS messageNo,
        DPI_IP AS ip,
        DPI_PORT AS port,
        DPI_DEV_NAME AS devName,
        DPI_SITE_NAME AS deploySiteName,
        OPERATETYPE AS operationType,
        MESSAGE_SEQUENCENO AS messageSequenceNo,
        DEV_FLAG AS devFlag,
        ZONGFEN_ID AS zongfenId,
        AREA_CODE AS areaCode,
        IDC_PORT AS idcPort,
        PROBE_TYPE AS probeType,
        CONNECTFLAG AS connectFlag,
        OPERATEFLAG AS operateFlag,
        REMARK AS remark,
        UPDATETIME AS updateTime
      from  DPI_V1_CFG_DPIINFO
      where DPI_IP = #{dpiIp} and OPERATETYPE in (1,2)

  </select>

  <select id="selectAllEuDeviceInfo" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from  (SELECT V.*,Z.Dev_Ip from  DPI_V1_CFG_DPIINFO V LEFT JOIN Dpi_V1_Cfg_Zongfeninfo Z ON Z.Dev_Id=V.Zongfen_Id where v.operatetype != 3)

  </select>

  <update id="updatePortToEmpty">
	UPDATE DPI_V1_CFG_DPIINFO SET DPI_PORT=NULL WHERE DPI_PORT=50000
  </update>

</mapper>