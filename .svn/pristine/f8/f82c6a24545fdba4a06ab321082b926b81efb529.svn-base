<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aotain.common.policyapi.mapper.ISPMessagePolicyMapper">

	<sql id="policyRuleColumn">
		RULEID AS ruleId,
		COMMANDID AS commandId,
		SUBTYPE  AS subType,
        VALUESTART AS valueStart,
        VALUEEND  AS valueEnd,
        KEYWORDRANGE AS keywordRange
	</sql>

	<resultMap id="BaseResultMap" type="com.aotain.common.policyapi.model.ISPMessagePolicy">
		<!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
		<result column="COMMANDID" jdbcType="DECIMAL" property="commandId" />
		<result column="MESSAGE_NO" jdbcType="VARCHAR" property="messageNo" />
		<result column="COMMAND_TYPE" jdbcType="DECIMAL" property="type" />
		<result column="ACTION_BLOCK" jdbcType="VARCHAR" property="blockFlag" />
		<result column="ACTION_LOG" jdbcType="DECIMAL" property="logFlag" />

		<result column="EFFECTTIME" jdbcType="VARCHAR" property="effectTime" />
		<result column="EXPIREDTIME" jdbcType="DECIMAL" property="expiredTime" />
		<result column="OPERATETYPE" jdbcType="VARCHAR" property="operationType" />
		<result column="MESSAGE_SEQUENCENO" jdbcType="DECIMAL" property="messageSequenceNo" />
		<result column="CREATE_TIME" jdbcType="VARCHAR" property="createTime" />
		<result column="CREATE_USERID" jdbcType="DECIMAL" property="userId" />
		<result column="CREATE_USERNAME" jdbcType="VARCHAR" property="userName" />

		<result column="POLICY_LEVEL" jdbcType="DECIMAL" property="level" />
		<result column="POLICY_STATE" jdbcType="VARCHAR" property="policyState" />
		<result column="IDCID" jdbcType="VARCHAR" property="idcID" />
		<result column="SMMS_CMDID" jdbcType="VARCHAR" property="smmsCommandId" />
		<result column="ACTION_REASON" jdbcType="VARCHAR" property="actionReason" />

		<result column="POLICYGROUPID" jdbcType="DECIMAL" property="groupId" />
		<result column="RULEGROUP_ID" jdbcType="DECIMAL" property="ruleGroupId" />
	</resultMap>

	<insert id="insertData" parameterType="com.aotain.common.policyapi.model.ISPMessagePolicy">
		<selectKey keyProperty="commandId" resultType="java.lang.Long" order="BEFORE">
			select seq_idc_isms_monitorpolicy_id.nextval from dual 
		</selectKey>
		 insert into IDC_ISMS_MONITOR_POLICY
	        (COMMANDID,
	         MESSAGE_NO,
	         COMMAND_TYPE,
	         ACTION_BLOCK,
	         ACTION_LOG,
	         EFFECTTIME,
	         EXPIREDTIME,
	         OPERATETYPE,
	         MESSAGE_SEQUENCENO,
	         CREATE_TIME,
	         CREATE_USERID,
	         CREATE_USERNAME,
	         POLICY_LEVEL,
	         POLICY_STATE,
			 IDCID,
			 MONITOR_TYPE,
			 SMMS_CMDID,
			 ACTION_REASON,
			 POLICYGROUPID,
			 RULEGROUP_ID
	         )
	      values
	        (#{commandId,jdbcType=DECIMAL},
	         #{messageNo,jdbcType=DECIMAL},
	         #{type,jdbcType=INTEGER},
	         #{blockFlag,jdbcType=INTEGER},
	         #{logFlag,jdbcType=INTEGER},
	         #{effectTime,jdbcType=DECIMAL},
	         #{expiredTime,jdbcType=DECIMAL},
			 ${@com.aotain.common.policyapi.constant.OperationConstants@OPERATION_SAVE},
	         #{messageSequenceNo,jdbcType=DECIMAL},
	         sysdate,
	         #{userId,jdbcType=VARCHAR},
	         #{userName,jdbcType=VARCHAR},
	         #{level,jdbcType=DECIMAL},
	         #{policyState,jdbcType=DECIMAL},
			 #{idcID,jdbcType=VARCHAR},
			 #{monitorType,jdbcType=INTEGER},
			 #{smmsCommandId,jdbcType=DECIMAL},
			 #{actionReason,jdbcType=VARCHAR},
			 #{groupId,jdbcType=DECIMAL},
			 #{ruleGroupId,jdbcType=DECIMAL}
	         )
	</insert>
	<update id="updateData" parameterType="com.aotain.common.policyapi.model.ISPMessagePolicy">
	  update IDC_ISMS_MONITOR_POLICY
         set COMMAND_TYPE       = #{type,jdbcType=INTEGER},
             ACTION_BLOCK       = #{blockFlag,jdbcType=INTEGER},
             ACTION_LOG         = #{logFlag,jdbcType=INTEGER},
             EFFECTTIME         = #{effectTime,jdbcType=DECIMAL},
             EXPIREDTIME        = #{expiredTime,jdbcType=DECIMAL},
             OPERATETYPE        = ${@com.aotain.common.policyapi.constant.OperationConstants@OPERATION_UPDATE},
             MESSAGE_SEQUENCENO = #{messageSequenceNo,jdbcType=DECIMAL},
             POLICY_STATE       = #{policyState,jdbcType=DECIMAL},
             IDCID              = #{idcID,jdbcType=VARCHAR},
			 SMMS_CMDID         = #{smmsCommandId,jdbcType=DECIMAL},
			 ACTION_REASON      = #{actionReason,jdbcType=VARCHAR},
			 POLICYGROUPID      = #{groupId,jdbcType=DECIMAL},
			 RULEGROUP_ID       = #{ruleGroupId,jdbcType=DECIMAL},
			 CREATE_TIME        = sysdate,
			 POLICY_LEVEL       = #{level}
       where COMMANDID = #{commandId}
	</update>
	<update id="deletePolicy" parameterType="com.aotain.common.policyapi.model.ISPMessagePolicy">
	  UPDATE IDC_ISMS_MONITOR_POLICY SET operatetype = 3, message_sequenceno = #{messageSequenceNo} WHERE COMMANDID = #{commandId}
	</update>
	
	<insert id="insertPolicyRule" parameterType="com.aotain.common.policyapi.model.ISPMessagePolicyRule">
		<selectKey keyProperty="ruleId" resultType="java.lang.Long" order="BEFORE">
			select seq_idc_isms_policyrule_id.nextval from dual 
		</selectKey>
		insert into IDC_ISMS_MONITOR_POLICY_RULE
          (RULEID, COMMANDID, SUBTYPE, VALUESTART, VALUEEND, KEYWORDRANGE)
        values
		(#{ruleId},
		#{commandId,jdbcType=DECIMAL},
		#{subType,jdbcType=INTEGER},
		#{valueStart,jdbcType=VARCHAR},
		#{valueEnd,jdbcType=VARCHAR},
		#{keywordRange,jdbcType=VARCHAR})
	</insert>
	<update id="updatePolicyRule" parameterType="com.aotain.common.policyapi.model.ISPMessagePolicyRule">
	   update IDC_ISMS_MONITOR_POLICY_RULE
           set SUBTYPE      = #{subType,jdbcType=INTEGER},
               VALUESTART   = #{valueStart,jdbcType=VARCHAR},
               VALUEEND     = #{valueEnd,jdbcType=VARCHAR},
               KEYWORDRANGE = #{keywordRange,jdbcType=VARCHAR})
         where RULEID = #{ruleId}
	</update>

	<delete id="deletePolicyRule" parameterType="com.aotain.common.policyapi.model.ISPMessagePolicy">
    	delete FROM IDC_ISMS_MONITOR_POLICY_RULE where COMMANDID = #{commandId}
	</delete>


	<select id="selectPolicyRuleListByCommandId" parameterType="long" resultType="com.aotain.common.policyapi.model.ISPMessagePolicyRule">
		select
		<include refid="policyRuleColumn"/>
		FROM IDC_ISMS_MONITOR_POLICY_RULE
		where COMMANDID = #{commandId}
	</select>

	<select id="selectByPrimaryKey" parameterType="long" resultMap="BaseResultMap">
		SELECT *
		FROM IDC_ISMS_MONITOR_POLICY
		where COMMANDID = #{commandId}
	</select>

	<select id="selectAllISPMessagePolicy" resultMap="BaseResultMap">
		SELECT *
		FROM IDC_ISMS_MONITOR_POLICY

	</select>
	
</mapper>